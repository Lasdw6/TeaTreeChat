name: Keep Backend Alive

on:
  schedule:
    - cron: '*/14 * * * *' # Runs every 14 minutes to prevent 15-min sleep
  workflow_dispatch: # Allows manual triggering from GitHub UI

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Render Backend
        env:
          # Replace this default URL with your actual Render backend URL if different
          # Or set a repository secret named BACKEND_URL
          BACKEND_URL: ${{ secrets.BACKEND_URL }}
        run: |
          if [ -z "$BACKEND_URL" ]; then
            echo "Error: BACKEND_URL secret is not set."
            echo "Please set BACKEND_URL in GitHub Repository Settings > Secrets > Actions"
            exit 1
          fi
          
          echo "Pinging backend..."
          # Use -I (HEAD) to be lightweight, or GET if HEAD not allowed
          # Using GET here to trigger the wake-up fully
          response=$(curl -s -o /dev/null -w "%{http_code}" "$BACKEND_URL")
          
          if [ "$response" -eq 200 ]; then
            echo "Success: Server is awake (Status 200)"
          else
            echo "Warning: Server responded with status $response"
            # We don't fail the build so we don't get spammed with failure emails if it sleeps
          fi

